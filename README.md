
# ğŸ¨ NovelAI Prompt Manager (NAI åŠ©æ‰‹)

<div align="center">

![Version](https://img.shields.io/badge/version-0.4.1-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![React](https://img.shields.io/badge/react-19.0-61dafb.svg)
![Cloudflare](https://img.shields.io/badge/cloudflare-D1%20%7C%20R2-orange.svg)

**ä¸“ä¸šçº§ NovelAI æç¤ºè¯ç®¡ç†å·¥å…· | å…¨æ ˆ Serverless æ¶æ„**

[ğŸš€ å¿«é€Ÿéƒ¨ç½²](#-å¿«é€Ÿéƒ¨ç½²) Â· [âœ¨ åŠŸèƒ½ç‰¹æ€§](#-æ ¸å¿ƒåŠŸèƒ½) Â· [ğŸ“– ä½¿ç”¨æ–‡æ¡£](#-ä½¿ç”¨æŒ‡å—) Â· [ğŸ› ï¸ æŠ€æœ¯æ¶æ„](#-%EF%B8%8F-æŠ€æœ¯æ¶æ„)

</div>

---

## ğŸŒŸ é¡¹ç›®ç®€ä»‹

NovelAI Prompt Manager æ˜¯ä¸€ä¸ªä¸“ä¸º NovelAI ç”¨æˆ·æ‰“é€ çš„ç°ä»£åŒ–æç¤ºè¯ç®¡ç†å¹³å°ã€‚

**v0.4.x é‡å¤§æ›´æ–°**ï¼šé¡¹ç›®å·²ä»çº¯å‰ç«¯åº”ç”¨å‡çº§ä¸ºåŸºäº Cloudflare Workers çš„**å…¨æ ˆåº”ç”¨**ã€‚å¼•å…¥äº† D1 æ•°æ®åº“å’Œ R2 å¯¹è±¡å­˜å‚¨ï¼Œå®ç°äº†å¤šç”¨æˆ·ç®¡ç†ã€äº‘ç«¯æ•°æ®åŒæ­¥ã€å›¾ç‰‡æŒä¹…åŒ–å­˜å‚¨ç­‰åŠŸèƒ½ï¼ŒåŒæ—¶ä¿ç•™äº†æœ¬åœ°ç”Ÿæˆå†å²çš„éšç§æ€§ã€‚

### ğŸ’¡ æ ¸å¿ƒä»·å€¼

- â›“ï¸ **Prompt Chain** - åƒç®¡ç†ä»£ç ä¸€æ ·ç®¡ç†æç¤ºè¯ï¼Œæ”¯æŒåŸºç¡€å±‚ã€æ¨¡å—å±‚ã€å˜é‡å±‚çš„è§£è€¦ä¸ç»„åˆã€‚
- â˜ï¸ **äº‘ç«¯åŒæ­¥** - æ‰€æœ‰ç”»å¸ˆä¸²ã€çµæ„Ÿå›¾ã€é…ç½®ä¿¡æ¯é€šè¿‡ Cloudflare D1 å­˜å‚¨ï¼Œå¤šç«¯å®æ—¶åŒæ­¥ã€‚
- ğŸ–¼ï¸ **R2 å›¾åºŠ** - é›†æˆ Cloudflare R2 å¯¹è±¡å­˜å‚¨ï¼Œä¸Šä¼ å°é¢å’Œçµæ„Ÿå›¾ä¸å†å ç”¨æœ¬åœ°ç©ºé—´ï¼Œæ”¯æŒæµå¼ä¸Šä¼ ã€‚
- ğŸ‘¥ **å¤šç”¨æˆ·ç³»ç»Ÿ** - å†…ç½®å®Œå–„çš„ Auth ç³»ç»Ÿï¼Œæ”¯æŒç®¡ç†å‘˜ï¼ˆAdminï¼‰å’Œæ™®é€šç”¨æˆ·ï¼Œé€‚åˆå°å›¢é˜Ÿæˆ–ä¸ªäººå¤šè®¾å¤‡ä½¿ç”¨ã€‚
- ğŸ§© **æ¨¡å—åŒ–è®¾è®¡** - å°†å…‰å½±ã€æ„å›¾ã€äººç‰©ç‰¹å¾æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œçµæ´»å¼€å…³æµ‹è¯•ã€‚
- ğŸ¨ **ç”»å¸ˆå†›ç«åº“** - å†…ç½®æƒé‡è®¡ç®—ã€Gacha éšæœºæŠ½å–ã€æ‰¹é‡å¯¼å…¥åŠŸèƒ½ã€‚
- ğŸ”’ **éšç§å®‰å…¨** - ç»˜å›¾ API Key ä»…å­˜å‚¨åœ¨æœ¬åœ°ï¼Œç”Ÿæˆå†å²ï¼ˆHistoryï¼‰é»˜è®¤å­˜å‚¨åœ¨æµè§ˆå™¨ IndexedDBï¼Œä¿æŠ¤éšç§ã€‚

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ› ï¸ åˆ›ä½œå·¥ä½œæµ

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| ğŸ“ **Prompt Chain** | æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ŒåŒ…å« Base Promptã€Modulesï¼ˆé£æ ¼æ¨¡å—ï¼‰ã€Paramsï¼ˆå‚æ•°ï¼‰ã€‚æ”¯æŒç‰ˆæœ¬è¿­ä»£ã€‚ |
| ğŸ”¢ **å˜é‡ç³»ç»Ÿ** | æ”¯æŒ `{subject}` ç­‰åŠ¨æ€å˜é‡è¾“å…¥ï¼Œä¸€å¥—é£æ ¼æ¨¡æ¿å¯å¿«é€Ÿå¤ç”¨äºä¸åŒè§’è‰²ã€‚ |
| ğŸ§ª **å®æ—¶é¢„è§ˆ** | é›†æˆ NAI API (V4.5)ï¼Œåç«¯ä»£ç†è½¬å‘è¯·æ±‚ï¼Œè§£å†³è·¨åŸŸé—®é¢˜ã€‚ |
| ğŸ“¦ **å°é¢ç®¡ç†** | ç”Ÿæˆæ»¡æ„çš„å›¾ç‰‡åï¼Œå¯ä¸€é”®ä¸Šä¼ è‡³ R2 å¹¶è®¾ä¸ºè¯¥ Chain çš„å°é¢ã€‚ |

### ğŸ“š èµ„æºç®¡ç†

- **ç”»å¸ˆå†›ç«åº“**ï¼š
  - æ”¯æŒ `artist:` å‰ç¼€å¼€å…³ï¼Œæ”¯æŒ `{}` `[]` æƒé‡è¯­æ³•ã€‚
  - **Gacha åŠŸèƒ½**ï¼šéšæœºæŠ½å–ç”»å¸ˆç»„åˆï¼Œå¯»æ‰¾æ„å¤–çš„åŒ–å­¦ååº”ã€‚
  - **æ‰¹é‡å¯¼å…¥**ï¼šæ”¯æŒä»æ–‡æœ¬æ‰¹é‡å¯¼å…¥ç”»å¸ˆåˆ—è¡¨ã€‚
- **çµæ„Ÿå›¾åº“ (Inspirations)**ï¼š
  - äº‘ç«¯å­˜å‚¨é«˜è´¨é‡ç”Ÿæˆçš„å›¾ç‰‡ã€‚
  - **è‡ªåŠ¨è§£æ**ï¼šä¸Šä¼  PNG å›¾ç‰‡è‡ªåŠ¨è¯»å– NAI å…ƒæ•°æ®ï¼ˆPrompt/Seed/Stepsï¼‰ã€‚
  - æ”¯æŒæ‰¹é‡ç®¡ç†ä¸åˆ é™¤ã€‚
- **æœ¬åœ°å†å² (GenHistory)**ï¼š
  - ç”Ÿæˆçš„å›¾ç‰‡è‡ªåŠ¨ä¿å­˜åœ¨æµè§ˆå™¨ IndexedDBã€‚
  - æ”¯æŒä¸€é”®â€œå‘å¸ƒâ€åˆ°äº‘ç«¯çµæ„Ÿå›¾åº“ã€‚

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

æœ¬é¡¹ç›®ä¾èµ– Cloudflare ç”Ÿæ€ï¼ˆPages + Workers + D1 + R2ï¼‰ã€‚

### å‰ç½®è¦æ±‚
- Node.js 18+
- Cloudflare è´¦å·
- Wrangler CLI (å¯é€‰ï¼Œç”¨äºæœ¬åœ°å¼€å‘)

### 1. å‡†å¤‡ Cloudflare èµ„æº

ä½ å¯ä»¥é€šè¿‡ Wrangler CLI å‘½ä»¤è¡Œåˆ›å»ºï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ Cloudflare ç½‘é¡µæ§åˆ¶å°ï¼ˆDashboardï¼‰åˆ›å»ºã€‚

#### æ–¹å¼ Aï¼šä½¿ç”¨ Wrangler CLI (æ¨è)
```bash
# 1. åˆ›å»º D1 æ•°æ®åº“
wrangler d1 create nai-db

# 2. åˆ›å»º R2 å­˜å‚¨æ¡¶
wrangler r2 bucket create nai-assets
```

#### æ–¹å¼ Bï¼šä½¿ç”¨ Cloudflare ç½‘é¡µæ§åˆ¶å°
1. **D1 æ•°æ®åº“**ï¼šè¿›å…¥ `Workers & Pages` -> `D1 SQL Database`ï¼Œç‚¹å‡»åˆ›å»ºï¼Œå‘½åä¸º `nai-db`ã€‚
2. **R2 å­˜å‚¨æ¡¶**ï¼šè¿›å…¥ `R2`ï¼Œç‚¹å‡»åˆ›å»ºå­˜å‚¨æ¡¶ï¼Œå‘½åä¸º `nai-assets`ã€‚
3. åˆ›å»ºå®Œæˆåï¼Œè®°ä¸‹å®ƒä»¬çš„ ID å’Œåç§°ã€‚

### 2. é…ç½®é¡¹ç›®

ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `wrangler.toml` æ–‡ä»¶ï¼Œå¡«å…¥ä¸Šä¸€æ­¥ç”Ÿæˆçš„ IDï¼š

```toml
[[d1_databases]]
binding = "DB"
database_name = "nai-db"
database_id = "æ›¿æ¢ä¸ºä½ åˆšåˆšåˆ›å»ºçš„æ•°æ®åº“ID"

[[r2_buckets]]
binding = "BUCKET"
bucket_name = "nai-assets"
```

### 3. è®¾ç½®æ„å»ºå‘½ä»¤ (Pages Settings)

åœ¨ Cloudflare Pages é¡¹ç›®åˆ›å»ºåï¼Œè¿›å…¥ **Settings** -> **Build & deployments** -> **Build configurations**ã€‚

å°† **Build command** ä¿®æ”¹ä¸ºï¼š
```bash
npx wrangler pages project create nai-prompt-manager --production-branch main || true && npx wrangler pages deploy dist --branch main
```
> æ³¨æ„ï¼šæ­¤å‘½ä»¤ç”¨äºåœ¨æ„å»ºæ—¶è‡ªåŠ¨ç»‘å®šèµ„æºå¹¶éƒ¨ç½²ã€‚å¦‚æœä½¿ç”¨ Git é›†æˆéƒ¨ç½²ï¼Œé€šå¸¸åªéœ€ `npm run build`ï¼Œå¹¶åœ¨æ§åˆ¶å°æ‰‹åŠ¨ç»‘å®š D1 (å˜é‡å `DB`) å’Œ R2 (å˜é‡å `BUCKET`)ã€‚ä¸Šè¿°å‘½ä»¤é€‚ç”¨äºæŸäº›ç‰¹å®šçš„ CI/CD æµç¨‹æˆ–ç¡®ä¿èµ„æºç»‘å®šçš„åœºæ™¯ã€‚

### 4. éƒ¨ç½²ä¸åˆå§‹åŒ–

1. æ¨é€ä»£ç åˆ° Git ä»“åº“ï¼Œè§¦å‘ Cloudflare Pages æ„å»ºã€‚
2. éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ä½ çš„ Pages åŸŸåã€‚
3. ç³»ç»Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–æ•°æ®åº“ç»“æ„ã€‚
4. é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š`admin`ï¼Œå¯†ç ï¼š`admin_996`ã€‚
5. **å¼ºçƒˆå»ºè®®**ï¼šé¦–æ¬¡ç™»å½•åï¼Œè¿›å…¥â€œæˆ‘çš„ -> ä¸ªäººè®¾ç½®â€ä¿®æ”¹å¯†ç ã€‚

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### é…ç½® API Key
é¦–æ¬¡ç”Ÿæˆå›¾ç‰‡æ—¶ï¼Œåœ¨ç¼–è¾‘å™¨å³ä¸Šè§’è¾“å…¥ä½ çš„ NovelAI API Keyã€‚
> ğŸ”‘ Key å­˜å‚¨åœ¨æµè§ˆå™¨ LocalStorage ä¸­ï¼Œå¹¶é€šè¿‡ HTTPS Header å‘é€ç»™ Worker ä»£ç†ï¼ŒWorker ä¸ä¼šä¿å­˜ä½ çš„ Keyã€‚

### æƒé™è¯´æ˜
- **Admin (ç®¡ç†å‘˜)**ï¼š
  - ç®¡ç†æ‰€æœ‰ç”¨æˆ·ã€ç”»å¸ˆæ•°æ®ã€‚
  - å¯ä»¥æŸ¥çœ‹å’Œåˆ é™¤æ‰€æœ‰äººçš„å…¬å¼€æ•°æ®ã€‚
  - åˆ›å»ºæ–°ç”¨æˆ·ã€‚
- **User (æ™®é€šç”¨æˆ·)**ï¼š
  - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤è‡ªå·±çš„ Prompt Chainã€‚
  - åªèƒ½ç®¡ç†è‡ªå·±çš„çµæ„Ÿå›¾ã€‚
  - æœ‰å­˜å‚¨ç©ºé—´é…é¢é™åˆ¶ï¼ˆé»˜è®¤ 300MBï¼‰ã€‚

### æ€§èƒ½ç›‘æ§
é¡¹ç›®é›†æˆäº† `Server-Timing` APIã€‚åœ¨ Chrome DevTools çš„ Network é¢æ¿ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„åç«¯è€—æ—¶ï¼ˆå¦‚ `db_check`, `r2_put`, `db_update`ï¼‰ï¼Œæ–¹ä¾¿æ’æŸ¥ä¸Šä¼ å»¶è¿Ÿé—®é¢˜ã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„

- **Frontend**: React 19, TypeScript, Tailwind CSS, Vite
- **Backend (Serverless)**: Cloudflare Workers (Functions)
- **Database**: Cloudflare D1 (SQLite)
- **Storage**: Cloudflare R2 (Object Storage)
- **Local Storage**: IndexedDB (Dexie-like raw implementation)
- **Security**: BCrypt password hashing, HttpOnly Session Cookies

---

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](./LICENSE) å¼€æºåè®®ã€‚

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ Star æ”¯æŒä¸€ä¸‹ï¼**

</div>
